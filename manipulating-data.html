<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to R: Data wrangling</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/manipulating-data.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 75%" class="percentage">
    75%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 75%" aria-valuenow="75" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/manipulating-data.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction to R and Rstudio</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="reading-in-data-readr-and-readxl.html">2. Reading in data: readr and readxl</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="tidying-data.html">3. Tidy data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        Data wrangling
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#manipulating-data-with-dplyr">Manipulating data with <code>dplyr</code></a></li>
<li><a href="#resources-and-acknowlegements">Resources and acknowlegements</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="visualizing-data.html">5. Data visualization</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="tidying-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="visualizing-data.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="tidying-data.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Tidy data</a>
        <a class="chapter-link float-end" href="visualizing-data.html" rel="next">Next: Data visualization... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Data wrangling</h1>
        <p> Last updated on 2022-11-24 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/manipulating-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What are the main <code>dplyr</code> verbs?</li>
<li>How can I analyse data within groups?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Know how to use the main <code>dplyr</code> verbs</li>
<li>Use <code>group_by()</code> to aggregate and manipulate within groups</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="manipulating-data-with-dplyr"><h2 class="section-heading">Manipulating data with <code>dplyr</code><a class="anchor" aria-label="anchor" href="#manipulating-data-with-dplyr"></a>
</h2>
<hr class="half-width"><p>So once we have our data in a tidy format, what do we do with it? For analysis, I often turn to the <code>dplyr</code> package, which contains several useful functions for manipulating tables of data.</p>
<p>To illustrate the functions of this package, we’ll use a dataset of weather observations in Brisbane and Sydney from <a href="http://www.bom.gov.au/climate/data/" class="external-link">the Bureau of Meterology</a>.</p>
<p>These files are called <code>weather_brisbane.csv</code> and <code>weather_sydney.csv</code>.</p>
<p>First, we load both files using <code>readr</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load tidyverse</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.0      ✔ purrr   0.3.5 
✔ tibble  3.1.8      ✔ dplyr   1.0.10
✔ tidyr   1.2.1      ✔ stringr 1.4.1 
✔ readr   2.1.3      ✔ forcats 0.5.2 
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data files</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">".."</span>, <span class="st">"episodes"</span>, <span class="st">"data"</span><span class="op">)</span> <span class="co"># change this for your computer</span></span>
<span><span class="va">data_files</span> <span class="op">&lt;-</span> <span class="fu">file.path</span><span class="op">(</span><span class="va">data_dir</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"weather_sydney.csv"</span>, <span class="st">"weather_brisbane.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># column types</span></span>
<span><span class="va">col_types</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="fu">col_date</span><span class="op">(</span>format<span class="op">=</span><span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>  min_temp_c <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  max_temp_c <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  rainfall_mm <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  evaporation_mm <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sunshine_hours <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dir_max_wind_gust <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  speed_max_wind_gust_kph <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  time_max_wind_gust <span class="op">=</span> <span class="fu">col_time</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  temp_9am_c <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  rel_humid_9am_pc <span class="op">=</span> <span class="fu">col_integer</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cloud_amount_9am_oktas <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wind_direction_9am <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wind_speed_9am_kph <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  MSL_pressure_9am_hPa <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  temp_3pm_c <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  rel_humid_3pm_pc <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cloud_amount_3pm_oktas <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wind_direction_3pm <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wind_speed_3pm_kph <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  MSL_pressure_3pm_hPa <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read in data</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="va">data_files</span>, skip<span class="op">=</span><span class="fl">10</span>, </span>
<span>                           col_types<span class="op">=</span><span class="va">col_types</span>, col_names <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">col_types</span><span class="op">)</span>,</span>
<span>                           id<span class="op">=</span><span class="st">"file"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: '/home/runner/work/cmri_R_workshop/cmri_R_workshop/site/built/../episodes/data/weather_sydney.csv' does not exist.</code></pre>
</div>
<div class="section level3">
<h3 id="creating-summaries-with-summarise">Creating summaries with <code>summarise()</code>
<a class="anchor" aria-label="anchor" href="#creating-summaries-with-summarise"></a></h3>
<p>First, we would like to know what the mean minimum and maximum temperatures were overall. For this, we can use <code>summarise()</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_min_temp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">min_temp_c</span><span class="op">)</span>,</span>
<span>            mean_max_temp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">max_temp_c</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in summarise(., mean_min_temp = mean(min_temp_c), mean_max_temp = mean(max_temp_c)): object 'weather' not found</code></pre>
</div>
<p>Notice that the mean_max_temp is <code>NA</code>, because we had some <code>NA</code> values in this column. In <code>R</code> we use <code>NA</code> for missing values. So how does one take the mean of some numbers, some of which are missing? We can’t so the answer is also a missing value. We can, however, tell the <code>mean()</code> function to ignore the missing values using <code>na.rm=TRUE</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_min_temp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">min_temp_c</span><span class="op">)</span>,</span>
<span>            mean_max_temp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">max_temp_c</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in summarise(., mean_min_temp = mean(min_temp_c), mean_max_temp = mean(max_temp_c, : object 'weather' not found</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-medians" class="callout-inner">
<h3 class="callout-title">Challenge 1: medians<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>What is the median minimum and maximum temperature in the weather observations?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>median_min_temp <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">min_temp_c</span><span class="op">)</span>,</span>
<span>            median_max_temp <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">max_temp_c</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in summarise(., median_min_temp = median(min_temp_c), median_max_temp = median(max_temp_c, : object 'weather' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><code>dplyr</code> also has some special functions that are designed to be used inside of other functions. For example, if we want to know how many observations there were of the minimum and maximum temperatures, we could use <code>n()</code>. Or if we wanted to know how many different directions the maximum wind gust had, we can use <code>n_distinct()</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n_days_observed <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            n_wind_dir <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">dir_max_wind_gust</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in summarise(., n_days_observed = n(), n_wind_dir = n_distinct(dir_max_wind_gust)): object 'weather' not found</code></pre>
</div>
<div class="section level4">
<h4 id="grouped-summaries-with-group_by">Grouped summaries with <code>group_by()</code>
<a class="anchor" aria-label="anchor" href="#grouped-summaries-with-group_by"></a></h4>
<p>However, all of these summaries have combined the observations for Sydney and Brisbane. It probably makes sense to group the observations by city, and then compute the summary statistics. For this, we can use <code>group_by()</code>.</p>
<p>If you use <code>group_by()</code> on a tibble, it doesn’t actually look like it changes that much.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., file): object 'weather' not found</code></pre>
</div>
<p>The only difference is that when you print it out, it tells you that it’s grouped by file. However, a grouped data frame interacts differently with other <code>dplyr</code> verbs, such as <code>summary</code>.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>median_min_temp <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">min_temp_c</span><span class="op">)</span>,</span>
<span>            median_max_temp <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">max_temp_c</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., file): object 'weather' not found</code></pre>
</div>
<p>Now we get the median temperature for both Sydney and Brisbane.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-medians" class="callout-inner">
<h3 class="callout-title">Challenge 2: medians<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>What is the maximum wind speed (<code>speed_max_wind_gust_kph</code>) in each direction (<code>dir_max_wind_gust</code>) for each city?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">file</span>, <span class="va">dir_max_wind_gust</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>max_max_wind_gust <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">speed_max_wind_gust_kph</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., file, dir_max_wind_gust): object 'weather' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-medians" class="callout-inner">
<h3 class="callout-title">Challenge 2: medians<em> (continued)</em><a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Can you pivot the table wider to make it easier to compare between directions and cities?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">file</span>, <span class="va">dir_max_wind_gust</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>max_max_wind_gust <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">speed_max_wind_gust_kph</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>id_cols<span class="op">=</span><span class="va">file</span>, names_from <span class="op">=</span> <span class="st">"dir_max_wind_gust"</span>, values_from <span class="op">=</span> <span class="st">"max_max_wind_gust"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., file, dir_max_wind_gust): object 'weather' not found</code></pre>
</div>
<p>Do you prefer the long or wide form of the table?</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="creating-new-columns-with-mutate">Creating new columns with <code>mutate()</code>
<a class="anchor" aria-label="anchor" href="#creating-new-columns-with-mutate"></a></h3>
<p>It’s kind of annoying that we have the whole file names, rather than just the names of the cities. To fix this, we can create (or overwrite) columns with <code>mutate()</code>.</p>
<figure><img src="https://ab604.github.io/docs/coding-together-2019/img/dplyr-mutate-16-10-2019.png" alt="" class="figure mx-auto d-block"><figcaption><code>dplyr::mutate()</code> <a href="https://ab604.github.io/docs/coding-together-2019" class="external-link">image credit</a></figcaption></figure><p>For example, the <code>stringr::str_extract()</code> function extracts a matching pattern from a string:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">data_files</span>, <span class="st">"sydney|brisbane"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "sydney"   "brisbane"</code></pre>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>The second argument to <code>str_extract()</code> is a regular expression, or <em>regex</em>. Using regular expressions is a hugely flexible way to specify a pattern to match in a string, but it’s a somewhat complicated topic that I won’t go into here. If you’re interested in learning more, you can look at the <a href="https://stringr.tidyverse.org/articles/regular-expressions.html" class="external-link">stringr documentation on regular expressions</a>.</p>
</div>
</div>
</div>
<p>We can use <code>mutate()</code> to apply the <code>str_extract()</code> function to the <code>file</code> column</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>city <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">file</span>, <span class="st">"sydney|brisbane"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in mutate(., city = stringr::str_extract(file, "sydney|brisbane")): object 'weather' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'weather' not found</code></pre>
</div>
<p>Now if we repeat the same summary as before, we get an output that’s a bit easier to read.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>median_min_temp <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">min_temp_c</span><span class="op">)</span>,</span>
<span>            median_max_temp <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">max_temp_c</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., city): object 'weather' not found</code></pre>
</div>
<div class="section level4">
<h4 id="mutating-multiple-columns-with-across">Mutating multiple columns with <code>across()</code>
<a class="anchor" aria-label="anchor" href="#mutating-multiple-columns-with-across"></a></h4>
<p>Let’s imagine that the calibration was wrong for both temperature sensors, and all the temperature measurements are out by 1°C. We’d like to add 1 to each of the temperature measurements. There are multiple columns that contain temperatures, so we could do this:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>min_temp_c <span class="op">=</span> <span class="va">min_temp_c</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>         max_temp_c <span class="op">=</span> <span class="va">max_temp_c</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>         temp_9am_c <span class="op">=</span> <span class="va">temp_9am_c</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>         temp_3pm_c <span class="op">=</span> <span class="va">temp_3pm_c</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in mutate(., min_temp_c = min_temp_c + 1, max_temp_c = max_temp_c + : object 'weather' not found</code></pre>
</div>
<p>But it’s a bit annoying to type out each column. Instead, we can use <code>across()</code> inside <code>mutate()</code> to apply the same transformation to all columns whose name contains the string “temp”. The syntax is a little complicated, so don’t worry if you don’t get it straight away. We use the <code>contains()</code> function to get the columns we want (by matching the regex “temp”), and then to each of these columns we add one - the <code>.</code> will be replaced by the name of each column when the expression is evaluated.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"temp"</span><span class="op">)</span>, <span class="op">~</span><span class="va">.</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in mutate(., across(contains("temp"), ~. + 1)): object 'weather' not found</code></pre>
</div>
<p>Equivalently, we could also use a function to make the transformation.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"temp"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">return</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in mutate(., across(contains("temp"), function(x) {: object 'weather' not found</code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="filtering-rows-with-filter">Filtering rows with <code>filter()</code>
<a class="anchor" aria-label="anchor" href="#filtering-rows-with-filter"></a></h3>
<p>Let’s say that now we want information about days that were cloudy - for example, those where there were fewer than 10 sunshine hours. We can use <code>filter()</code> to get only those rows.</p>
<figure><img src="https://ab604.github.io/docs/coding-together-2019/img/dplyr_filter.png" alt="" class="figure mx-auto d-block"><figcaption><code>dplyr::filter()</code> <a href="https://ab604.github.io/docs/coding-together-2019" class="external-link">image credit</a></figcaption></figure><div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">sunshine_hours</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in filter(., sunshine_hours &lt; 10): object 'weather' not found</code></pre>
</div>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3-is-it-better-to-live-in-sydney-or-brisbane" class="callout-inner">
<h3 class="callout-title">Challenge 3: Is it better to live in Sydney or Brisbane?<a class="anchor" aria-label="anchor" href="#challenge4"></a>
</h3>
<div class="callout-content">
<p>Combine <code>filter()</code> with <code>group_by()</code>,<code>summarise()</code> and <code>n()</code> to count the number of days when there were more than 10 hours of sunshine in each city.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">sunshine_hours</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n_days <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in filter(., sunshine_hours &gt; 10): object 'weather' not found</code></pre>
</div>
<p>There were more days with more than 10 hours of sunlight in Brisbane than in Sydney. I’ll let you draw your own conclusions.</p>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="complex-filters-with-case_when">Complex filters with <code>case_when()</code>
<a class="anchor" aria-label="anchor" href="#complex-filters-with-case_when"></a></h4>
<p>Let’s say we wanted to keep only the rows from sunny, warm days and cloudy, cold days. We could do this just with one logical expression.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">(</span><span class="va">sunshine_hours</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">max_temp_c</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">sunshine_hours</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">max_temp_c</span> <span class="op">&lt;</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in filter(., (sunshine_hours &gt; 10 &amp; max_temp_c &gt; 25) | (sunshine_hours &lt; : object 'weather' not found</code></pre>
</div>
<p>But you can imagine that with more conditions, this can get a bit messy. I prefer to use <code>case_when()</code> in such situations:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">sunshine_hours</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">max_temp_c</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="va">sunshine_hours</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">max_temp_c</span> <span class="op">&lt;</span> <span class="fl">15</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in filter(., case_when(sunshine_hours &gt; 10 &amp; max_temp_c &gt; 25 ~ TRUE, : object 'weather' not found</code></pre>
</div>
<p>Essentially, <code>case_when()</code> looks at each condition in turn, and if the left part of the expression (before the <code>~</code>) evaulates to <code>TRUE</code>, then it returns whatever is on the right of the <code>~</code>.</p>
<ul><li>We first ask if this row has more than ten sunshine hours and a maximum temperature of more than 25 - if this is the case, we return <code>TRUE</code> (and <code>filter()</code> retains this row).<br></li>
<li>Next, we ask if the row has less than ten sunshine hours and a maximum temperature of less than 15, in which case we also return <code>TRUE</code>.<br></li>
<li>If both these statements are <code>FALSE</code>, then the <code>TRUE</code> on the next line ensures that we don’t keep those rows by always returning <code>FALSE</code>.</li>
</ul><div id="challenge5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4-using-case_when-with-mutate" class="callout-inner">
<h3 class="callout-title">Challenge 4: Using <code>case_when()</code> with <code>mutate()</code><a class="anchor" aria-label="anchor" href="#challenge5"></a>
</h3>
<div class="callout-content">
<p><code>case_when()</code> is also quite useful in combination with <code>mutate()</code>.</p>
<p>For example, let’s suppose you want to compare the mean relative humidity on about cloudy cold days and sunny hot days.</p>
<p>You can first use <code>mutate()</code> and <code>case_when()</code> to create a column that tells which of these categories the day belongs to (<code>hot_sunny</code>, <code>cold_cloudy</code>, or <code>neither</code>), and then use <code>group_by()</code> and <code>summarise()</code> to get the mean relative humidity at 9am and 3pm.</p>
<p>Write the code to compute this.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>day_type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">sunshine_hours</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">max_temp_c</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">~</span> <span class="st">"hot_sunny"</span>,</span>
<span>    <span class="va">sunshine_hours</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">max_temp_c</span> <span class="op">&lt;</span> <span class="fl">15</span> <span class="op">~</span> <span class="st">"cold_cloudy"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"neither"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">day_type</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_rel_humid_9am <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">rel_humid_9am_pc</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            mean_rel_humid_3pm <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">rel_humid_3pm_pc</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in mutate(., day_type = case_when(sunshine_hours &gt; 10 &amp; max_temp_c &gt; : object 'weather' not found</code></pre>
</div>
<p>Notice that we didn’t actually have any cold cloudy days, but hot sunny days seem to be less humid.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="filter-within-groups-with-slice_xxx">Filter within groups with <code>slice_xxx()</code>
<a class="anchor" aria-label="anchor" href="#filter-within-groups-with-slice_xxx"></a></h4>
<p>If you want to filter within groups, you could use <code>filter()</code> and <code>group_by()</code> together - for example if we wanted to know what the hottest day in each city was, you might try this:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">max_temp_c</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">max_temp_c</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., city): object 'weather' not found</code></pre>
</div>
<p>But it doesn’t work! The reasons why are somewhat technical, so here I’ll sidestep them and just give you the solution instead: use <code>slice_max()</code></p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slice_max</span><span class="op">(</span>order_by<span class="op">=</span><span class="va">max_temp_c</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., city): object 'weather' not found</code></pre>
</div>
<p>If you want the minimum values instead, use <code>slice_min()</code> and if you want a random sample, use <code>slice_sample()</code>.</p>
<div id="challenge6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5-hottest-days" class="callout-inner">
<h3 class="callout-title">Challenge 5: Hottest days<a class="anchor" aria-label="anchor" href="#challenge6"></a>
</h3>
<div class="callout-content">
<p>What is the mean maximum temperature on the 5 hottest days in each city?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># use with_ties to ensure we only get five rows</span></span>
<span>  <span class="fu">slice_max</span><span class="op">(</span>order_by<span class="op">=</span><span class="va">max_temp_c</span>, n<span class="op">=</span><span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    mean_temp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">max_temp_c</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., city): object 'weather' not found</code></pre>
</div>
<p>Ooof, Brisbane was hot! Maybe this changes your conclusion about which city is better.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="selecting-columns-with-select">Selecting columns with <code>select()</code>
<a class="anchor" aria-label="anchor" href="#selecting-columns-with-select"></a></h3>
<p>If you want to drop or only retain columns from your table, use <code>select()</code>.</p>
<figure><img src="https://ab604.github.io/docs/coding-together-2019/img/dplyr_select.png" alt="" class="figure mx-auto d-block"><figcaption><code>dplyr::select()</code> <a href="https://ab604.github.io/docs/coding-together-2019" class="external-link">image credit</a></figcaption></figure><p>For example, we added a <code>city</code> column to our table, so we can drop the <code>file</code> column that also contains this information.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">file</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in select(., -file): object 'weather' not found</code></pre>
</div>
<p>Alternatively, if we only wanted to keep the date, city and the 3pm observations, we can do this as well.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, <span class="va">city</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"3pm"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in select(., date, city, contains("3pm")): object 'weather' not found</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="sorting-rows-with-arrange">Sorting rows with <code>arrange()</code>
<a class="anchor" aria-label="anchor" href="#sorting-rows-with-arrange"></a></h3>
<p>You can re-order the rows in a table by the values in one or more columns using <code>arrange()</code>.</p>
<figure><img src="https://ab604.github.io/docs/coding-together-2019/img/dplyr_arrange.png" alt="dplyr::arrange() image credit" class="figure mx-auto d-block"> Here I sort for the hottest days, using <code>desc()</code> to get the maximum temperatures in descending order.</figure><div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">max_temp_c</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in arrange(., desc(max_temp_c)): object 'weather' not found</code></pre>
</div>
<div id="challenge7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-6-using-arrange-with-mutate" class="callout-inner">
<h3 class="callout-title">Challenge 6: Using <code>arrange()</code> with <code>mutate()</code><a class="anchor" aria-label="anchor" href="#challenge7"></a>
</h3>
<div class="callout-content">
<p>Sometimes I use <code>arrange()</code> with <code>mutate()</code> and <code>row_number()</code> to add ranks to a table.</p>
<p>Add a column ranking the days by minimum temperature for each city, where the coldest day for each is rank 1, the next coldest is rank 2, etc.</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">min_temp_c</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rank <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># select only the relevant columns to verify that it worked</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">city</span>, <span class="va">date</span>, <span class="va">min_temp_c</span>, <span class="va">rank</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in group_by(., city): object 'weather' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="joining-data-frames">Joining data frames<a class="anchor" aria-label="anchor" href="#joining-data-frames"></a></h3>
<p>So far, we’ve only dealt with methods that work on one data frame. Sometimes it’s useful to combine information from two tables together to get a more complete picture of the data.</p>
<p>There are several joining functions, which fall into two categories:</p>
<ul><li>
<a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">mutating joins</a>, which add extra columns to tables based on matching values</li>
<li>
<a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">filtering joins</a>, which don’t add extra columns but change the number of rows</li>
</ul><p>Here, I’ll only cover the join I use the most, <code>left_join()</code>, but there are several joins of each type, which I will leave to you to explore more using the links above.</p>
<figure><img src="https://ab604.github.io/docs/coding-together-2019/img/left_join.png" alt="" class="figure mx-auto d-block"><figcaption>left join</figcaption></figure><p>Let’s say we have a second table which contains the forecast for each day. Here I generate this randomly, but you could equally use <code>readr</code> or <code>readxl</code> to load this data in if you have it in a file.</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, <span class="va">city</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>forecast <span class="op">=</span> <span class="fu">sample</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"cloudy"</span>, <span class="st">"sunny"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in select(., date, city): object 'weather' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'forecast' not found</code></pre>
</div>
<p>Now we would like to join this to our data frame of observations, so we can compare the forecast to what actually happened.</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">forecast</span>, by<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"city"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">city</span>, <span class="va">date</span>, <span class="va">sunshine_hours</span>, <span class="va">forecast</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in left_join(., forecast, by = c("date", "city")): object 'weather' not found</code></pre>
</div>
<div id="challenge8" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-7-blame-it-on-the-weatherman" class="callout-inner">
<h3 class="callout-title">Challenge 7: <a href="https://www.youtube.com/watch?v=t2UFV2R3EZM" class="external-link">Blame it on the weatherman</a><a class="anchor" aria-label="anchor" href="#challenge8"></a>
</h3>
<div class="callout-content">
<p>If a cloudy day is one where there are 10 or fewer hours of sunshine, on how many days was the forecast accurate?</p>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># join forecast information</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">forecast</span>, by<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"city"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># was forecast accurate</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>forecast_accurate <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">sunshine_hours</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">forecast</span> <span class="op">==</span> <span class="st">"sunny"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="va">sunshine_hours</span> <span class="op">&lt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">forecast</span> <span class="op">==</span> <span class="st">"cloudy"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># count accurate and inaccurate forecasts</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">forecast_accurate</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in left_join(., forecast, by = c("date", "city")): object 'weather' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="resources-and-acknowlegements"><h2 class="section-heading">Resources and acknowlegements<a class="anchor" aria-label="anchor" href="#resources-and-acknowlegements"></a>
</h2>
<hr class="half-width"><ul><li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf" class="external-link">dplyr cheatsheet</a></li>
<li><a href="https://dplyr.tidyverse.org/" class="external-link">dplyr documentation</a></li>
<li><a href="https://r4ds.had.co.nz/transform.html" class="external-link">Data transformation in R for data science</a></li>
<li>I’ve borrowed figures (and inspiration) from the excellent <a href="https://ab604.github.io/docs/coding-together-2019/data-wrangle-1.html" class="external-link">coding togetheR course material</a>
</li>
</ul><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Use <code>summarise()</code> to summarise your data</li>
<li>Use <code>mutate()</code> to add new columns</li>
<li>Use <code>filter()</code> to filter rows by a condition</li>
<li>Use <code>select()</code> to remove or only retain certain rows</li>
<li>Use <code>arrange()</code> to re-order rows</li>
<li>Use <code>group_by()</code> to group data by the values in particular columns</li>
<li>Use joins to combine two data frames</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="tidying-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="visualizing-data.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="tidying-data.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Tidy data</a>
        <a class="chapter-link float-end" href="visualizing-data.html" rel="next">Next: Data visualization... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/manipulating-data.Rmd" class="external-link">Edit on GitHub</a>
        
        
        
        | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:sscott@cmri.org.au">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.10.8)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.3.2" class="external-link">pegboard (0.3.2)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.9" class="external-link">varnish (0.2.9)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/manipulating-data.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Data wrangling",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/manipulating-data.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/manipulating-data.html",
  "dateCreated": "2022-11-24",
  "dateModified": "2022-11-24",
  "datePublished": "2022-11-24"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

